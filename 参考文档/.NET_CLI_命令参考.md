# .NET CLI 命令参考指南

## 核心命令介绍

### 1. dotnet build

**作用**：编译项目，将源代码转换为可执行的程序集（DLL 或 EXE）

```bash
dotnet build
```

**常见选项**：

| 选项 | 说明 | 示例 |
|------|------|------|
| `-c, --configuration` | 指定配置类型（Debug/Release） | `dotnet build -c Release` |
| `-f, --framework` | 指定目标框架 | `dotnet build -f net10.0` |
| `--no-restore` | 不还原依赖项 | `dotnet build --no-restore` |
| `-v, --verbosity` | 设置输出详度（q/m/n/d） | `dotnet build -v d` |
| `--force` | 强制重新生成 | `dotnet build --force` |

**输出结果**：
- 成功：`已成功生成。0 个警告, 0 个错误`
- 失败：`生成失败。X 个错误`

---

### 2. dotnet run

**作用**：编译并运行项目（用于控制台应用）

```bash
dotnet run
```

**常见选项**：

| 选项 | 说明 | 示例 |
|------|------|------|
| `-c, --configuration` | 指定配置（Debug/Release） | `dotnet run -c Release` |
| `-f, --framework` | 指定框架 | `dotnet run -f net10.0` |
| `--no-build` | 不构建，直接运行 | `dotnet run --no-build` |
| `--project` | 指定项目文件 | `dotnet run --project ./app.csproj` |
| `-- <args>` | 传递参数给应用 | `dotnet run -- arg1 arg2` |

**示例**：
```bash
# 以 Release 模式运行
dotnet run -c Release

# 运行并传递参数
dotnet run -- --help
```

---

### 3. dotnet restore

**作用**：还原项目依赖项（从 NuGet 下载 packages）

```bash
dotnet restore
```

**常见选项**：

| 选项 | 说明 | 示例 |
|------|------|------|
| `--source` | 指定 NuGet 源 | `dotnet restore --source https://api.nuget.org/v3/index.json` |
| `-v, --verbosity` | 输出详度 | `dotnet restore -v d` |
| `--locked-mode` | 仅还原已锁定版本 | `dotnet restore --locked-mode` |

---

### 4. dotnet clean

**作用**：删除编译生成的文件（bin 和 obj 目录）

```bash
dotnet clean
```

**常见选项**：

| 选项 | 说明 | 示例 |
|------|------|------|
| `-c, --configuration` | 清理特定配置 | `dotnet clean -c Debug` |
| `-f, --framework` | 清理特定框架 | `dotnet clean -f net10.0` |
| `--nologo` | 不显示 logo | `dotnet clean --nologo` |

---

### 5. dotnet test

**作用**：运行项目的单元测试

```bash
dotnet test
```

**常见选项**：

| 选项 | 说明 | 示例 |
|------|------|------|
| `-c, --configuration` | 指定配置 | `dotnet test -c Release` |
| `--filter` | 筛选测试 | `dotnet test --filter "TestClass.TestMethod"` |
| `-v, --verbosity` | 输出详度 | `dotnet test -v d` |
| `--collect:"XPlat Code Coverage"` | 收集代码覆盖率 | `dotnet test --collect:"XPlat Code Coverage"` |

---

### 6. dotnet add package

**作用**：添加 NuGet 包到项目

```bash
dotnet add package <包名> [版本]
```

**示例**：
```bash
# 添加最新版本
dotnet add package Newtonsoft.Json

# 添加指定版本
dotnet add package Spectre.Console --version 0.54.0

# 添加到指定项目
dotnet add ./src/MyProject.csproj package Serilog
```

---

### 7. dotnet remove package

**作用**：从项目中移除 NuGet 包

```bash
dotnet remove package <包名>
```

**示例**：
```bash
dotnet remove package Newtonsoft.Json
```

---

## 常用组合命令

### 场景 1：完整清理并重新构建

```bash
# 清理旧文件，还原依赖，构建项目
dotnet clean && dotnet restore && dotnet build
```

**说明**：用于解决神秘的编译错误、清理缓存污染

---

### 场景 2：开发时快速运行（Skip 构建缓存）

```bash
# 强制清理后构建并运行
dotnet clean && dotnet run
```

或者直接使用 `--force` 标志：

```bash
dotnet build --force && dotnet run
```

---

### 场景 3：以 Release 模式构建和运行

```bash
# 编译为 Release，获得最佳性能
dotnet build -c Release && dotnet run -c Release
```

---

### 场景 4：构建并检查输出

```bash
# 构建并显示详细输出（用于调试编译问题）
dotnet build -v d

# 或者使用 minimal（最少输出）
dotnet build -v m
```

---

### 场景 5：杀死旧进程，清理，重新运行

```bash
# PowerShell 示例（在 Windows 上）
Stop-Process -Name ImageAnalyzerCore -Force -ErrorAction SilentlyContinue; `
Start-Sleep -Seconds 2; `
cd 'c:\path\to\project'; `
dotnet clean && dotnet build && dotnet run
```

**说明**：用于解决"文件被另一个进程占用"的错误

---

### 场景 6：构建后查看输出统计

```bash
# 显示构建摘要（成功/失败/警告数）
dotnet build 2>&1 | Select-Object -Last 10
```

---

### 场景 7：构建特定框架（多框架项目）

```bash
# 仅为 net10.0 构建
dotnet build -f net10.0

# 为所有目标框架构建
dotnet build
```

---

### 场景 8：无依赖更新的快速构建

```bash
# 跳过 NuGet 还原，加快构建速度
dotnet build --no-restore
```

---

## 输出详度级别（Verbosity）

在 `dotnet build`、`dotnet test` 等命令中，`-v` 或 `--verbosity` 用于控制输出详度：

| 级别 | 速记 | 说明 |
|------|------|------|
| quiet | `q` | 仅显示错误 |
| minimal | `m` | 仅显示错误和摘要（**默认**） |
| normal | `n` | 标准输出 |
| detailed | `d` | 显示详细信息（调试编译问题） |
| diagnostic | `diag` | 最详细的诊断信息 |

**示例**：
```bash
# 显示所有详细编译信息
dotnet build -v d

# 仅显示错误（安静模式）
dotnet build -v q
```

---

## 配置选项（Configuration）

大多数命令都支持 `-c` 或 `--configuration` 来指定构建配置：

| 配置 | 说明 | 用途 |
|------|------|------|
| `Debug` | 调试配置 | 开发阶段，保留调试符号，性能较低 |
| `Release` | 发布配置 | 生产环境，优化代码，文件更小 |

**示例**：
```bash
# Debug 构建（默认）
dotnet build

# Release 构建
dotnet build -c Release
```

---

## 常见问题与解决方案

### 问题 1：文件被另一个进程占用

```bash
# 杀死占用进程，等待，重新构建
Stop-Process -Name <应用名> -Force -ErrorAction SilentlyContinue
Start-Sleep -Seconds 2
dotnet build
```

---

### 问题 2：NuGet 包版本冲突

```bash
# 清理 NuGet 缓存和本地文件
dotnet clean
dotnet nuget locals all --clear
dotnet restore
```

---

### 问题 3：项目引用错误

```bash
# 检查依赖项并重新还原
dotnet restore -v d
```

---

### 问题 4：构建输出过多，查找关键信息

```bash
# 仅查看最后 20 行（包含摘要）
dotnet build 2>&1 | Select-Object -Last 20

# 仅查看错误
dotnet build 2>&1 | Select-String "error"
```

---

## 项目中常用的命令模板

### 在本项目中的使用示例

```bash
# 标准开发流程
cd 'c:\个人数据\C#Code\ImageAnalyzerCore'
dotnet build

# 运行应用
dotnet run

# 快速重建（清理缓存）
dotnet clean && dotnet build

# Release 构建用于部署
dotnet build -c Release

# 构建并显示详细输出（调试）
dotnet build -v d

# 杀死旧进程后重建
Stop-Process -Name ImageAnalyzerCore -Force -ErrorAction SilentlyContinue; `
Start-Sleep -Seconds 2; `
dotnet build && dotnet run
```

---

## 总结速查表

| 命令 | 用途 | 常用选项 |
|------|------|---------|
| `dotnet build` | 编译项目 | `-c Release`, `-v d`, `--no-restore` |
| `dotnet run` | 编译并运行 | `-c Release`, `--no-build`, `-- args` |
| `dotnet restore` | 还原依赖 | `--source`, `--locked-mode` |
| `dotnet clean` | 清理输出 | `-c Debug`, `-f net10.0` |
| `dotnet test` | 运行测试 | `--filter`, `--collect:...` |
| `dotnet add package` | 添加包 | `--version x.x.x` |
| `dotnet remove package` | 移除包 | 无常见选项 |

---

**文档更新时间**：2025-11-18
